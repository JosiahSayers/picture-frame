import{s as V,e as k,a as v,w as R,f as y,i as g,n as L,d as c,l as E,t as ce,b as M,o as H,m as fe,p as q,q as we,A as be,C as ke,v as oe,I as ve}from"../chunks/scheduler.gdzB-wWo.js";import{S as X,i as G,g as ee,a as U,e as te,t as C,c as F,b as j,m as A,d as N}from"../chunks/index.elnLltOd.js";import{e as Z,u as xe,o as ye}from"../chunks/each.XQcfs4Pq.js";import{T as Ce}from"../chunks/title.BDtqUt0a.js";import{d as Pe,w as D}from"../chunks/index.zKgYT3hc.js";const Ue=!1,Se=!0,Ke=Object.freeze(Object.defineProperty({__proto__:null,prerender:Se,ssr:Ue},Symbol.toStringTag,{value:"Module"}));function Ee(n){let e,t='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" class="w-6 h-6 stroke-current"><path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75 11.25 15 15 9.75M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"></path></svg>';return{c(){e=k("span"),e.innerHTML=t,this.h()},l(l){e=v(l,"SPAN",{class:!0,"data-svelte-h":!0}),R(e)!=="svelte-1jcwku3"&&(e.innerHTML=t),this.h()},h(){y(e,"class","text-success inline-block")},m(l,a){g(l,e,a)},p:L,i:L,o:L,d(l){l&&c(e)}}}class He extends X{constructor(e){super(),G(this,e,null,Ee,V,{})}}function Le(n){let e,t='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6"><path stroke-linecap="round" stroke-linejoin="round" d="m9.75 9.75 4.5 4.5m0-4.5-4.5 4.5M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"></path></svg>';return{c(){e=k("span"),e.innerHTML=t,this.h()},l(l){e=v(l,"SPAN",{class:!0,"data-svelte-h":!0}),R(e)!=="svelte-1o9iqs7"&&(e.innerHTML=t),this.h()},h(){y(e,"class","text-error inline-block")},m(l,a){g(l,e,a)},p:L,i:L,o:L,d(l){l&&c(e)}}}class Me extends X{constructor(e){super(),G(this,e,null,Le,V,{})}}function Te(n){let e,t;return e=new Me({}),{c(){F(e.$$.fragment)},l(l){j(e.$$.fragment,l)},m(l,a){A(e,l,a),t=!0},i(l){t||(C(e.$$.fragment,l),t=!0)},o(l){U(e.$$.fragment,l),t=!1},d(l){N(e,l)}}}function Qe(n){let e,t;return e=new He({}),{c(){F(e.$$.fragment)},l(l){j(e.$$.fragment,l)},m(l,a){A(e,l,a),t=!0},i(l){t||(C(e.$$.fragment,l),t=!0)},o(l){U(e.$$.fragment,l),t=!1},d(l){N(e,l)}}}function qe(n){let e;return{c(){e=k("span"),this.h()},l(t){e=v(t,"SPAN",{class:!0}),M(e).forEach(c),this.h()},h(){y(e,"class","loading loading-bars loading-md inline-block")},m(t,l){g(t,e,l)},i:L,o:L,d(t){t&&c(e)}}}function Ie(n){let e,t,l,a,i,r=n[0].file.name+"",p,$;const b=[qe,Qe,Te],u=[];function w(d,m){return d[0].status==="uploading"||d[0].status==="waiting"?0:d[0].status==="complete"?1:2}return t=w(n),l=u[t]=b[t](n),{c(){e=k("p"),l.c(),a=E(),i=k("span"),p=ce(r),this.h()},l(d){e=v(d,"P",{class:!0});var m=M(e);l.l(m),a=H(m),i=v(m,"SPAN",{class:!0});var S=M(i);p=fe(S,r),S.forEach(c),m.forEach(c),this.h()},h(){y(i,"class","ml-1 text-lg"),y(e,"class","flex items-center mb-3")},m(d,m){g(d,e,m),u[t].m(e,null),q(e,a),q(e,i),q(i,p),$=!0},p(d,[m]){let S=t;t=w(d),t!==S&&(ee(),U(u[S],1,1,()=>{u[S]=null}),te(),l=u[t],l||(l=u[t]=b[t](d),l.c()),C(l,1),l.m(e,a)),(!$||m&1)&&r!==(r=d[0].file.name+"")&&we(p,r)},i(d){$||(C(l),$=!0)},o(d){U(l),$=!1},d(d){d&&c(e),u[t].d()}}}function Fe(n,e,t){let{upload:l}=e;return n.$$set=a=>{"upload"in a&&t(0,l=a.upload)},[l]}class pe extends X{constructor(e){super(),G(this,e,Fe,Ie,V,{upload:0})}}const de=n=>(n.preventDefault(),n.returnValue=""),je=()=>{console.log("blocking page closes"),window.addEventListener("beforeunload",de,{capture:!0})},Ae=()=>{console.log("unblocking page closes"),window.removeEventListener("beforeunload",de,{capture:!0})};let K=!1;const x=[],B=D(x),le=D([]),me=D(),he=D(),_e=D([]),Ne=Pe(B,(n,e)=>{let t="empty";n.some(a=>a.status==="uploading"||a.status==="waiting")?t="uploading":n.length&&(t="complete");const l=n.filter(a=>a.status==="complete"||a.status==="failed");e({text:t,totalFiles:n.length,completedFiles:l.length,percentComplete:(l.length||0)/(n.length||1)*100})}),De=n=>{const e={status:"waiting",name:n.name,file:n};x.length===0&&(je(),le.set([])),x.push(e),B.set(x),ge()},W=(n,e)=>{const t=x.find(l=>l.name===n);t&&(t.status=e.status??t.status),B.set(x)},ge=async()=>{const n=x.find(e=>e.status==="uploading")||x.find(e=>e.status==="waiting");if(!K)if(n){W(n.name,{status:"uploading"});try{K=!0,await Be(n.file),K=!1,W(n.name,{status:"complete"})}catch(e){console.log(e),W(n.name,{status:"failed"}),le.update(t=>[...t,n])}me.set(n),await ge()}else{he.set(new Date),_e.update(e=>[...x,...e]),x.splice(0,x.length),B.set(x),Ae();return}};function Be(n){const e=new FormData;return e.append("name",n.name),e.append("file",n),fetch("/api/images",{method:"post",body:e})}const Y={addToQueue:De,fileQueue:B,uploadCompleted:me,allUploadsCompleted:he,queueStatus:Ne,failedUploads:le,uploadHistory:_e};function ae(n,e,t){const l=n.slice();return l[8]=e[t],l}function re(n,e,t){const l=n.slice();return l[8]=e[t],l}function Oe(n){let e;return{c(){e=ce("Upload")},l(t){e=fe(t,"Upload")},m(t,l){g(t,e,l)},d(t){t&&c(e)}}}function ie(n,e){let t,l,a,i;return l=new pe({props:{upload:e[8]}}),{key:n,first:null,c(){t=k("li"),F(l.$$.fragment),a=E(),this.h()},l(r){t=v(r,"LI",{});var p=M(t);j(l.$$.fragment,p),a=H(p),p.forEach(c),this.h()},h(){this.first=t},m(r,p){g(r,t,p),A(l,t,null),q(t,a),i=!0},p(r,p){e=r;const $={};p&4&&($.upload=e[8]),l.$set($)},i(r){i||(C(l.$$.fragment,r),i=!0)},o(r){U(l.$$.fragment,r),i=!1},d(r){r&&c(t),N(l)}}}function ue(n){let e,t,l,a;return t=new pe({props:{upload:n[8]}}),{c(){e=k("li"),F(t.$$.fragment),l=E()},l(i){e=v(i,"LI",{});var r=M(e);j(t.$$.fragment,r),l=H(r),r.forEach(c)},m(i,r){g(i,e,r),A(t,e,null),q(e,l),a=!0},p(i,r){const p={};r&8&&(p.upload=i[8]),t.$set(p)},i(i){a||(C(t.$$.fragment,i),a=!0)},o(i){U(t.$$.fragment,i),a=!1},d(i){i&&c(e),N(t)}}}function ze(n){let e,t,l,a,i,r,p="Currently Uploading",$,b,u=[],w=new Map,d,m,S="Upload History",O,T,z,J,ne;e=new Ce({props:{$$slots:{default:[Oe]},$$scope:{ctx:n}}});let I=Z(n[2]);const se=s=>s[8].file.name;for(let s=0;s<I.length;s+=1){let o=re(n,I,s),h=se(o);w.set(h,u[s]=ie(h,o))}let Q=Z(n[3]),f=[];for(let s=0;s<Q.length;s+=1)f[s]=ue(ae(n,Q,s));const $e=s=>U(f[s],1,1,()=>{f[s]=null});return{c(){F(e.$$.fragment),t=E(),l=k("form"),a=k("input"),i=E(),r=k("p"),r.textContent=p,$=E(),b=k("ul");for(let s=0;s<u.length;s+=1)u[s].c();d=E(),m=k("p"),m.textContent=S,O=E(),T=k("ul");for(let s=0;s<f.length;s+=1)f[s].c();this.h()},l(s){j(e.$$.fragment,s),t=H(s),l=v(s,"FORM",{class:!0});var o=M(l);a=v(o,"INPUT",{type:!0,class:!0}),o.forEach(c),i=H(s),r=v(s,"P",{class:!0,"data-svelte-h":!0}),R(r)!=="svelte-1yq5se0"&&(r.textContent=p),$=H(s),b=v(s,"UL",{class:!0});var h=M(b);for(let P=0;P<u.length;P+=1)u[P].l(h);h.forEach(c),d=H(s),m=v(s,"P",{class:!0,"data-svelte-h":!0}),R(m)!=="svelte-zhmw2m"&&(m.textContent=S),O=H(s),T=v(s,"UL",{});var _=M(T);for(let P=0;P<f.length;P+=1)f[P].l(_);_.forEach(c),this.h()},h(){y(a,"type","file"),a.multiple=!0,y(a,"class","file-input w-full max-w-xs"),y(l,"class","mb-24"),y(r,"class","text-xl mb-2"),y(b,"class","mb-20"),y(m,"class","text-xl mb-2")},m(s,o){A(e,s,o),g(s,t,o),g(s,l,o),q(l,a),n[7](a),g(s,i,o),g(s,r,o),g(s,$,o),g(s,b,o);for(let h=0;h<u.length;h+=1)u[h]&&u[h].m(b,null);g(s,d,o),g(s,m,o),g(s,O,o),g(s,T,o);for(let h=0;h<f.length;h+=1)f[h]&&f[h].m(T,null);z=!0,J||(ne=be(a,"change",n[6]),J=!0)},p(s,[o]){const h={};if(o&8192&&(h.$$scope={dirty:o,ctx:s}),e.$set(h),o&4&&(I=Z(s[2]),ee(),u=xe(u,o,se,1,s,I,w,b,ye,ie,null,re),te()),o&8){Q=Z(s[3]);let _;for(_=0;_<Q.length;_+=1){const P=ae(s,Q,_);f[_]?(f[_].p(P,o),C(f[_],1)):(f[_]=ue(P),f[_].c(),C(f[_],1),f[_].m(T,null))}for(ee(),_=Q.length;_<f.length;_+=1)$e(_);te()}},i(s){if(!z){C(e.$$.fragment,s);for(let o=0;o<I.length;o+=1)C(u[o]);for(let o=0;o<Q.length;o+=1)C(f[o]);z=!0}},o(s){U(e.$$.fragment,s);for(let o=0;o<u.length;o+=1)U(u[o]);f=f.filter(Boolean);for(let o=0;o<f.length;o+=1)U(f[o]);z=!1},d(s){s&&(c(t),c(l),c(i),c(r),c($),c(b),c(d),c(m),c(O),c(T)),N(e,s),n[7](null);for(let o=0;o<u.length;o+=1)u[o].d();ke(f,s),J=!1,ne()}}}function Ze(n,e,t){let l,a,i,r;const p=Y.fileQueue;oe(n,p,w=>t(2,l=w));const $=Y.uploadHistory;oe(n,$,w=>t(3,a=w));function b(){i=this.files,t(0,i)}function u(w){ve[w?"unshift":"push"](()=>{r=w,t(1,r),t(0,i)})}return n.$$.update=()=>{if(n.$$.dirty&1&&i){for(const w of i)Y.addToQueue(w);t(1,r.value="",r)}},[i,r,l,a,p,$,b,u]}class We extends X{constructor(e){super(),G(this,e,Ze,ze,V,{})}}export{We as component,Ke as universal};
