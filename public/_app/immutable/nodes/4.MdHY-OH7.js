import{s as z,e as $,a as k,w as O,f as x,i as g,n as I,d as p,l as E,t as he,b as H,o as S,m as _e,p as L,q as be,A as ve,v as ae,I as xe}from"../chunks/scheduler.gdzB-wWo.js";import{S as Z,i as X,g as ee,a as P,e as te,t as C,c as Q,b as j,m as q,d as N}from"../chunks/index.elnLltOd.js";import{e as V,u as ie,o as ue}from"../chunks/each.XQcfs4Pq.js";import{T as Ue}from"../chunks/title.BDtqUt0a.js";import{w as ge}from"../chunks/index.zKgYT3hc.js";const Pe=!1,Ce=!0,et=Object.freeze(Object.defineProperty({__proto__:null,prerender:Ce,ssr:Pe},Symbol.toStringTag,{value:"Module"}));function Ee(l){let e,n='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" class="w-6 h-6 stroke-current"><path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75 11.25 15 15 9.75M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"></path></svg>';return{c(){e=$("span"),e.innerHTML=n,this.h()},l(t){e=k(t,"SPAN",{class:!0,"data-svelte-h":!0}),O(e)!=="svelte-1jcwku3"&&(e.innerHTML=n),this.h()},h(){x(e,"class","text-success inline-block")},m(t,a){g(t,e,a)},p:I,i:I,o:I,d(t){t&&p(e)}}}class Se extends Z{constructor(e){super(),X(this,e,null,Ee,z,{})}}function Ie(l){let e,n='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6"><path stroke-linecap="round" stroke-linejoin="round" d="m9.75 9.75 4.5 4.5m0-4.5-4.5 4.5M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"></path></svg>';return{c(){e=$("span"),e.innerHTML=n,this.h()},l(t){e=k(t,"SPAN",{class:!0,"data-svelte-h":!0}),O(e)!=="svelte-1o9iqs7"&&(e.innerHTML=n),this.h()},h(){x(e,"class","text-error inline-block")},m(t,a){g(t,e,a)},p:I,i:I,o:I,d(t){t&&p(e)}}}class He extends Z{constructor(e){super(),X(this,e,null,Ie,z,{})}}function Me(l){let e,n;return e=new He({}),{c(){Q(e.$$.fragment)},l(t){j(e.$$.fragment,t)},m(t,a){q(e,t,a),n=!0},i(t){n||(C(e.$$.fragment,t),n=!0)},o(t){P(e.$$.fragment,t),n=!1},d(t){N(e,t)}}}function Te(l){let e,n;return e=new Se({}),{c(){Q(e.$$.fragment)},l(t){j(e.$$.fragment,t)},m(t,a){q(e,t,a),n=!0},i(t){n||(C(e.$$.fragment,t),n=!0)},o(t){P(e.$$.fragment,t),n=!1},d(t){N(e,t)}}}function Le(l){let e;return{c(){e=$("span"),this.h()},l(n){e=k(n,"SPAN",{class:!0}),H(e).forEach(p),this.h()},h(){x(e,"class","loading loading-bars loading-md inline-block")},m(n,t){g(n,e,t)},i:I,o:I,d(n){n&&p(e)}}}function Ae(l){let e,n,t,a,i,r=l[0].file.name+"",u,m;const y=[Le,Te,Me],c=[];function b(d,h){return d[0].status==="uploading"||d[0].status==="waiting"?0:d[0].status==="complete"?1:2}return n=b(l),t=c[n]=y[n](l),{c(){e=$("p"),t.c(),a=E(),i=$("span"),u=he(r),this.h()},l(d){e=k(d,"P",{class:!0});var h=H(e);t.l(h),a=S(h),i=k(h,"SPAN",{class:!0});var U=H(i);u=_e(U,r),U.forEach(p),h.forEach(p),this.h()},h(){x(i,"class","ml-1 text-lg"),x(e,"class","flex items-center mb-3")},m(d,h){g(d,e,h),c[n].m(e,null),L(e,a),L(e,i),L(i,u),m=!0},p(d,[h]){let U=n;n=b(d),n!==U&&(ee(),P(c[U],1,1,()=>{c[U]=null}),te(),t=c[n],t||(t=c[n]=y[n](d),t.c()),C(t,1),t.m(e,a)),(!m||h&1)&&r!==(r=d[0].file.name+"")&&be(u,r)},i(d){m||(C(t),m=!0)},o(d){P(t),m=!1},d(d){d&&p(e),c[n].d()}}}function De(l,e,n){let{upload:t}=e;return l.$$set=a=>{"upload"in a&&n(0,t=a.upload)},[t]}class we extends Z{constructor(e){super(),X(this,e,De,Ae,z,{upload:0})}}const ye=l=>(l.preventDefault(),l.returnValue=""),Qe=()=>{console.log("blocking page closes"),window.addEventListener("beforeunload",ye,{capture:!0})},je=()=>{console.log("unblocking page closes"),window.removeEventListener("beforeunload",ye,{capture:!0})};let B;const qe=new Uint8Array(16);function Ne(){if(!B&&(B=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!B))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return B(qe)}const _=[];for(let l=0;l<256;++l)_.push((l+256).toString(16).slice(1));function Fe(l,e=0){return _[l[e+0]]+_[l[e+1]]+_[l[e+2]]+_[l[e+3]]+"-"+_[l[e+4]]+_[l[e+5]]+"-"+_[l[e+6]]+_[l[e+7]]+"-"+_[l[e+8]]+_[l[e+9]]+"-"+_[l[e+10]]+_[l[e+11]]+_[l[e+12]]+_[l[e+13]]+_[l[e+14]]+_[l[e+15]]}const Re=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),ce={randomUUID:Re};function Ve(l,e,n){if(ce.randomUUID&&!e&&!l)return ce.randomUUID();l=l||{};const t=l.random||(l.rng||Ne)();if(t[6]=t[6]&15|64,t[8]=t[8]&63|128,e){n=n||0;for(let a=0;a<16;++a)e[n+a]=t[a];return e}return Fe(t)}let K=!1;const v=[],G=ge(v),$e=ge([]),Be=l=>{const n=(Array.isArray(l)?l:[l]).map(a=>({status:"waiting",file:a,id:Ve()})),t=v.length;v.push(...n),G.set(v),t===0&&(Qe(),ke())},W=(l,e)=>{const n=v.find(t=>t.id===l);n&&(n.status=e),G.set(v)},ke=async()=>{const l=v.find(e=>e.status==="uploading")||v.find(e=>e.status==="waiting");if(!K)if(l){W(l.id,"uploading");try{K=!0,await Oe(l.file),W(l.id,"complete")}catch(e){console.log(e),W(l.id,"failed")}finally{K=!1}ke()}else{$e.update(e=>[...v,...e]),v.splice(0,v.length),G.set(v),je();return}};async function Oe(l){const e=new FormData;e.append("name",l.name),e.append("file",l);const n=await fetch("/api/images",{method:"post",body:e});if(!n.ok||n.status!==200)throw new Error(`Failed to upload ${l.name}`)}const Y={addToQueue:Be,fileQueue:G,uploadHistory:$e};function pe(l,e,n){const t=l.slice();return t[8]=e[n],t}function fe(l,e,n){const t=l.slice();return t[8]=e[n],t}function ze(l){let e;return{c(){e=he("Upload")},l(n){e=_e(n,"Upload")},m(n,t){g(n,e,t)},d(n){n&&p(e)}}}function de(l,e){let n,t,a,i;return t=new we({props:{upload:e[8]}}),{key:l,first:null,c(){n=$("li"),Q(t.$$.fragment),a=E(),this.h()},l(r){n=k(r,"LI",{});var u=H(n);j(t.$$.fragment,u),a=S(u),u.forEach(p),this.h()},h(){this.first=n},m(r,u){g(r,n,u),q(t,n,null),L(n,a),i=!0},p(r,u){e=r;const m={};u&4&&(m.upload=e[8]),t.$set(m)},i(r){i||(C(t.$$.fragment,r),i=!0)},o(r){P(t.$$.fragment,r),i=!1},d(r){r&&p(n),N(t)}}}function me(l,e){let n,t,a,i;return t=new we({props:{upload:e[8]}}),{key:l,first:null,c(){n=$("li"),Q(t.$$.fragment),a=E(),this.h()},l(r){n=k(r,"LI",{});var u=H(n);j(t.$$.fragment,u),a=S(u),u.forEach(p),this.h()},h(){this.first=n},m(r,u){g(r,n,u),q(t,n,null),L(n,a),i=!0},p(r,u){e=r;const m={};u&8&&(m.upload=e[8]),t.$set(m)},i(r){i||(C(t.$$.fragment,r),i=!0)},o(r){P(t.$$.fragment,r),i=!1},d(r){r&&p(n),N(t)}}}function Ze(l){let e,n,t,a,i,r,u="Currently Uploading",m,y,c=[],b=new Map,d,h,U="Upload History",F,M,w=[],ne=new Map,R,J,le;e=new Ue({props:{$$slots:{default:[ze]},$$scope:{ctx:l}}});let A=V(l[2]);const se=s=>s[8].id;for(let s=0;s<A.length;s+=1){let o=fe(l,A,s),f=se(o);b.set(f,c[s]=de(f,o))}let D=V(l[3]);const oe=s=>s[8].id;for(let s=0;s<D.length;s+=1){let o=pe(l,D,s),f=oe(o);ne.set(f,w[s]=me(f,o))}return{c(){Q(e.$$.fragment),n=E(),t=$("form"),a=$("input"),i=E(),r=$("p"),r.textContent=u,m=E(),y=$("ul");for(let s=0;s<c.length;s+=1)c[s].c();d=E(),h=$("p"),h.textContent=U,F=E(),M=$("ul");for(let s=0;s<w.length;s+=1)w[s].c();this.h()},l(s){j(e.$$.fragment,s),n=S(s),t=k(s,"FORM",{class:!0});var o=H(t);a=k(o,"INPUT",{type:!0,class:!0}),o.forEach(p),i=S(s),r=k(s,"P",{class:!0,"data-svelte-h":!0}),O(r)!=="svelte-1yq5se0"&&(r.textContent=u),m=S(s),y=k(s,"UL",{class:!0});var f=H(y);for(let T=0;T<c.length;T+=1)c[T].l(f);f.forEach(p),d=S(s),h=k(s,"P",{class:!0,"data-svelte-h":!0}),O(h)!=="svelte-zhmw2m"&&(h.textContent=U),F=S(s),M=k(s,"UL",{});var re=H(M);for(let T=0;T<w.length;T+=1)w[T].l(re);re.forEach(p),this.h()},h(){x(a,"type","file"),a.multiple=!0,x(a,"class","file-input w-full max-w-xs"),x(t,"class","mb-24"),x(r,"class","text-xl mb-2"),x(y,"class","mb-20"),x(h,"class","text-xl mb-2")},m(s,o){q(e,s,o),g(s,n,o),g(s,t,o),L(t,a),l[7](a),g(s,i,o),g(s,r,o),g(s,m,o),g(s,y,o);for(let f=0;f<c.length;f+=1)c[f]&&c[f].m(y,null);g(s,d,o),g(s,h,o),g(s,F,o),g(s,M,o);for(let f=0;f<w.length;f+=1)w[f]&&w[f].m(M,null);R=!0,J||(le=ve(a,"change",l[6]),J=!0)},p(s,[o]){const f={};o&8192&&(f.$$scope={dirty:o,ctx:s}),e.$set(f),o&4&&(A=V(s[2]),ee(),c=ie(c,o,se,1,s,A,b,y,ue,de,null,fe),te()),o&8&&(D=V(s[3]),ee(),w=ie(w,o,oe,1,s,D,ne,M,ue,me,null,pe),te())},i(s){if(!R){C(e.$$.fragment,s);for(let o=0;o<A.length;o+=1)C(c[o]);for(let o=0;o<D.length;o+=1)C(w[o]);R=!0}},o(s){P(e.$$.fragment,s);for(let o=0;o<c.length;o+=1)P(c[o]);for(let o=0;o<w.length;o+=1)P(w[o]);R=!1},d(s){s&&(p(n),p(t),p(i),p(r),p(m),p(y),p(d),p(h),p(F),p(M)),N(e,s),l[7](null);for(let o=0;o<c.length;o+=1)c[o].d();for(let o=0;o<w.length;o+=1)w[o].d();J=!1,le()}}}function Xe(l,e,n){let t,a,i,r;const u=Y.fileQueue;ae(l,u,b=>n(2,t=b));const m=Y.uploadHistory;ae(l,m,b=>n(3,a=b)),u.subscribe(console.log);function y(){i=this.files,n(0,i)}function c(b){xe[b?"unshift":"push"](()=>{r=b,n(1,r),n(0,i)})}return l.$$.update=()=>{l.$$.dirty&1&&i&&(Y.addToQueue(Array.from(i)),n(1,r.value="",r))},[i,r,t,a,u,m,y,c]}class tt extends Z{constructor(e){super(),X(this,e,Xe,Ze,z,{})}}export{tt as component,et as universal};
